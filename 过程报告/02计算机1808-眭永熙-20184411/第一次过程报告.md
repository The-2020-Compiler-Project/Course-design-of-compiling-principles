# 语法分析器

## Grammar类

### 成员：

`lexical&`  ` _lexical`   <!--词法分析器-->

`token` `word`   <!--token对象--> 

后续还将接入语义分析器和错误处理器成员

### 成员函数：

使用递归下降子程序法

``` c++
void analyzer();     	    //分析器

void Program();             //<程序>

void SubProgram();          //<分程序>

void ConstDecl();           //<常量说明部分>

void ConstDef();            //<常量定义>

void IsConst();             //<常量>

void VarDecl();             //<变量说明部分>

void VarDef();              //<变量说明>

void TypeDecl();            //<类型>

void BasicType();           //<基本类型>

void CompoundStatement();   //<复合语句>

void Statement();           //<语句>

void AssignStatement();     //<赋值语句>

void Expression();          //<表达式>

void Item();                //<项>

void Factor();              //<因子>

void AddOperator();         //<加法运算符>

void MulOperator();         //<乘法运算符>
```

以上部分全部实现，后续需要增加填充符号表的工作以及扩充文法。


# 中间代码优化

## Optimizer类

### 成员：

``` c++

class Optimizer{

public:

    Optimizer(fstream&);
    
    void optimize();                                                      //对外接口
    
private:

    fstream& file;                                                        //四元式序列文件
    
    vector<DAG> dag;                                                      //DAG图数据结构
    
    vector<vector<string>> TAC;                                           //分块后的四元式序列
    
    map<string,int> mp;

    void divBlock();                                                      //分块函数

    void createDAG(vector<string>&);                                      //构建DAG图

    int findNode(DAG_node&);                                              //查找结点，返回位置，0表示未找到

    int findOperation(string& op,DAG_node& src1,DAG_node& src2);          //查找公共表达式，返回位置，0表示未找到

    void createByBlock();                                                 //分块构建      

    pair<int,bool> new_node(DAG_node&);                                   //创建新节点，返回位置，若已存在返回<位置，true>

    void erase_ID(int id,DAG_node& str);                                  //从某节点中删除标识符

    void insert_ID(int id, DAG_node& str);                                //在某节点中插入标识符

    string calculate(string& op,string& a,string& b);                     //计算常数表达式

    void rebulid();                                                       //重组四元式
};

```

以上除了重组四元式和对外接口没有实现，其余部分均已实现。后续将进行调试。


